<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shawarma Details</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Datalabels plugin for showing values -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
	
	
	
</head>
<body class="bg-gray-0">
	<!-- Wavy Background -->
	<div>
		<div class="fixed w-full top-0 overflow-hidden"><svg id="visual" viewBox="0 0 440 960" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><rect x="0" y="0" fill="#ffffff"></rect><defs><linearGradient id="grad1_0" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="30%" stop-color="#ffd580" stop-opacity="1"></stop><stop offset="70%" stop-color="#ffd580" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad1_1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="30%" stop-color="#ffd580" stop-opacity="1"></stop><stop offset="70%" stop-color="#ffeabf" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad1_2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="30%" stop-color="#ffffff" stop-opacity="1"></stop><stop offset="70%" stop-color="#ffeabf" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_0" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="30%" stop-color="#ffd580" stop-opacity="1"></stop><stop offset="70%" stop-color="#ffd580" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="30%" stop-color="#ffeabf" stop-opacity="1"></stop><stop offset="70%" stop-color="#ffd580" stop-opacity="1"></stop></linearGradient></defs><defs><linearGradient id="grad2_2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="30%" stop-color="#ffeabf" stop-opacity="1"></stop><stop offset="70%" stop-color="#ffffff" stop-opacity="1"></stop></linearGradient></defs><g transform="translate(440, 0)"><path d="M0 378C-24.6 359.6 -49.1 341.3 -77 337.3C-104.9 333.4 -136 343.8 -163.6 339.7C-191.1 335.6 -215.1 316.9 -235.7 295.5C-256.3 274.1 -273.5 249.9 -278.3 222C-283.2 194 -275.5 162.2 -290.1 139.7C-304.7 117.2 -341.4 103.9 -359.7 82.1C-378.1 60.4 -378 30.2 -378 0L0 0Z" fill="#fff4df"></path><path d="M0 252C-16.4 239.8 -32.8 227.5 -51.3 224.9C-69.9 222.2 -90.7 229.2 -109 226.4C-127.4 223.7 -143.4 211.3 -157.1 197C-170.8 182.8 -182.3 166.6 -185.6 148C-188.8 129.3 -183.7 108.2 -193.4 93.1C-203.1 78.1 -227.6 69.2 -239.8 54.7C-252.1 40.2 -252 20.1 -252 0L0 0Z" fill="#ffdfa0"></path><path d="M0 126C-8.2 119.9 -16.4 113.8 -25.7 112.4C-35 111.1 -45.3 114.6 -54.5 113.2C-63.7 111.9 -71.7 105.6 -78.6 98.5C-85.4 91.4 -91.2 83.3 -92.8 74C-94.4 64.7 -91.8 54.1 -96.7 46.6C-101.6 39.1 -113.8 34.6 -119.9 27.4C-126 20.1 -126 10.1 -126 0L0 0Z" fill="#ffd580"></path></g></svg></div>
		
	  </div>

    <div class="relative max-w-md mx-auto min-h-screen p-6">
        <!-- Header -->
        <div class="z-1 flex px-6 left-0 fixed w-full justify-between items-center mb-8">
            <button onclick="history.back()" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <button class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
                </svg>
            </button>
        </div>

        <!-- Title -->
        <div class="text-center mb-6 pt-14">
            <h1 class="text-2xl font-bold mb-2">Shwarma with fresh Arabic</h1>
        </div>

        <!-- Food Image -->
       <div class="relative w-72 h-72 mx-auto mb-8">
    <img 
        src="https://marcustansoon.github.io/PhysicsEngine.js-2D/temp/App%20Development/Calorie-Tracker/resources/spicy-spaghetti-arrabbiata.jpg" 
        alt="Shawarma" 
        class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-72 h-72 object-cover rounded-full"
    >
</div>
		
		<div class="bg-white p-6 rounded-t-3xl -mx-6 -mb-6">


        <!-- Nutritional Info -->
		
		
		<div class="mb-8">
            <div class="flex items-center mb-2 justify-center">
                    <span class="text-xl mr-2">ìçù</span>
                    <h2 class="text-lg font-semibold text-gray-800">Nutrient Breakdown</h2>
            </div>
		</div>
				
				
        <div class="flex gap-4 mb-8 justify-around">
			<div class="flex flex-col">
				<div class="flex items-center gap-2">
					<span class="text-2xl">üî•</span>
					<div>
						<div class="font-semibold">Calories</div>
						<div class="text-gray-500">482k</div>
					</div>
				</div>
				<div class="flex items-center gap-2 mt-2">
					<span class="text-2xl">ü•ì</span>
					<div>
						<div class="font-semibold">Fats</div>
						<div class="text-gray-500">25g</div>
					</div>
				</div>
			</div>
			<div class="flex flex-col">
				<div class="flex items-center gap-2">
					<span class="text-2xl">ü•ö</span>
					<div>
						<div class="font-semibold">Proteins</div>
						<div class="text-gray-500">125g</div>
					</div>
				</div>
				<div class="flex items-center gap-2 mt-2">
					<span class="text-2xl">üåæ</span>
					<div>
						<div class="font-semibold">Carbs</div>
						<div class="text-gray-500">75g</div>
					</div>
				</div>
			</div>
        </div>
		
		
		  <!-- Donut Chart -->
		<div class="mb-8">
			<div class="relative">
				<canvas id="nutrientChart"></canvas>
			</div>
		</div>

        <!-- Details -->
        <div class="mb-8">
            <h2 class="font-bold mb-3">Details</h2>
            <p class="text-gray-600 text-sm mb-2">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed diam nonummy eirmod tempor invidunt ut labore et dolore...
                
            </p>
        </div>

		
        <!-- Minerals & Vitamins -->
        <div id="vitamin-main-container" class="mb-8 hidden">
            <h2 class="font-bold mb-4">Minerals & Vitamins Daily Value (%)</h2>
				<div id="vitamin-charts" class="grid grid-flow-row grid-cols-2 max-w-md py-6 overflow-y-auto gap-4">
				</div>
        </div>
		
        <!-- Fat Composition -->
        <div class="mb-8">
            <h2 class="font-bold mb-4">Fat Composition (%)</h2>
                <div class="relative w-full" style="height: 200px;">
				<canvas id="fat-chart"  style="height: 200px;"></canvas>
				</div>
        </div>
		
		
        <!-- Vegetables -->
        <div class="mb-8 hidden">
            <h2 class="font-bold mb-4">Vegetables</h2>
            <div class="grid grid-cols-4 gap-4">
                <div class="aspect-square bg-green-100 rounded-2xl flex items-center justify-center">
                    <span class="text-2xl">ü•¶</span>
                </div>
                <div class="aspect-square bg-red-100 rounded-2xl flex items-center justify-center">
                    <span class="text-2xl">üçÖ</span>
                </div>
                <div class="aspect-square bg-green-100 rounded-2xl flex items-center justify-center">
                    <span class="text-2xl">ü•¨</span>
                </div>
                <div class="aspect-square bg-green-100 rounded-2xl flex items-center justify-center">
                    <span class="text-2xl">üå∂Ô∏è</span>
                </div>
            </div>
        </div>
		
		  <!-- Cholesterol Chart -->
        <div class="mb-8">
            <h2 class="font-bold mb-4">Cholesterol Daily Value (%)</h2>
            <div class="">
                <div class="relative w-full" style="height: 200px;">
                    <canvas id="cholesterol-chart"></canvas>
                </div>
                <p class="hidden text-gray-600 text-sm mt-2">1/2 | Remain 1 | Last week's avg: 0.6</p>
            </div>
		</div>
		
	
		
		
		
		<div>
			<div class="max-w-md mx-auto fix1ed bottom-0 bg-white bottom-0 left-0 right-0 rounded-t-3xl">
				<!-- Add Meal Button -->
				<div class="flex gap-2">
					<div class="flex items-center gap-3 bg-orange-400 rounded-2xl cursor-pointer justify-center w-4/5">
						<div><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0,0,256,256">
		<g fill="#ffffff" fill-rule="evenodd" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(10.66667,10.66667)"><path d="M11,2v9h-9v2h9v9h2v-9h9v-2h-9v-9z"></path></g></g>
		</svg></div>
		<div class="text-white py-4 rounded-2xl font-medium"> Add Meal</div>
					</div>
					<div class="flex items-center gap-3 rounded-2xl cursor-pointer justify-center border border-black w-1/5">
						<div>
							<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0 0 50 50">
		<path d="M 25 2 A 1.0001 1.0001 0 1 0 25 4 C 36.609534 4 46 13.390466 46 25 C 46 36.609534 36.609534 46 25 46 C 13.390466 46 4 36.609534 4 25 C 4 18.307314 7.130711 12.364806 12 8.5195312 L 12 15 A 1.0001 1.0001 0 1 0 14 15 L 14 6.5507812 L 14 5 L 4 5 A 1.0001 1.0001 0 1 0 4 7 L 10.699219 7 C 5.4020866 11.214814 2 17.712204 2 25 C 2 37.690466 12.309534 48 25 48 C 37.690466 48 48 37.690466 48 25 C 48 12.309534 37.690466 2 25 2 z"></path>
							</svg>
						</div>
					  </div>
				</div>
				
			</div>
		</div>
		
		
		</div>
		
		
		
		
    </div>
	
	
<script>


        // Register the datalabels plugin
    Chart.register(ChartDataLabels);
	
	
	
	function plotFatChart (){
		const ctx = document.getElementById('fat-chart').getContext('2d');
		const fatCompositionChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [''], // No y-axis label
        datasets: [
          {
            label: 'Saturated Fat',
            data: [40],
            backgroundColor: '#ef4444', // Red-500
            borderWidth: 2,
            borderColor: '#fff',
            barPercentage: 0.5
          },
          {
            label: 'Unsaturated Fat',
            data: [55],
            backgroundColor: '#3b82f6', // Blue-500
            borderWidth: 2,
            borderColor: '#fff',
            barPercentage: 0.5
          },
          {
            label: 'Trans Fat',
            data: [5],
            backgroundColor: '#f59e0b', // Amber-500
            borderWidth: 2,
            borderColor: '#fff',
            barPercentage: 0.5
          }
        ]
      },
      options: {
        indexAxis: 'y', // Horizontal bar
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { 
			display: true,
			position: 'bottom', // Place it at the bottom
		  }, // No legend
          datalabels: {
			display: false,
            color: '#fff', // White text for contrast
            font: { size: 14, weight: 'bold' },
            formatter: (value) => value, // Show raw value
            anchor: 'center', // Center the label in each segment
            align: 'center'
          },
          tooltip: {
            enabled: true,
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleFont: { size: 14 },
            bodyFont: { size: 12 }
          }
        },
        scales: {
          x: {
            stacked: true,
            grid: { display: false },
            ticks: { color: '#4b5563', font: { size: 12 } },
            title: {
              display: true,
              text: 'Percentage (%)',
              color: '#4b5563',
              font: { size: 14, weight: 'bold' }
            },
            max: 100
          },
          y: {
            stacked: true,
            display: false // No y-axis
          }
        }
      }
    });
	}
	plotFatChart();
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	function darkenHexColor(hex, factor = 0.7) {
    // Remove '#' if present and validate hex
    hex = hex.replace('#', '');
    if (hex.length !== 6) throw new Error('Invalid hex color');

    // Convert hex to RGB
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);

    // Darken each RGB value (multiply by factor, ensuring values stay between 0 and 255)
    const darkenedR = Math.max(0, Math.min(255, Math.floor(r * factor)));
    const darkenedG = Math.max(0, Math.min(255, Math.floor(g * factor)));
    const darkenedB = Math.max(0, Math.min(255, Math.floor(b * factor)));

    // Convert back to hex, padding with zeros if necessary
    const darkenedHex = `#${darkenedR.toString(16).padStart(2, '0')}${darkenedG.toString(16).padStart(2, '0')}${darkenedB.toString(16).padStart(2, '0')}`.toUpperCase();

    return darkenedHex;
}


		

// Load the image (do this outside the chart initialization)
const appleImage = new Image();
appleImage.src = 'https://cdn-icons-png.flaticon.com/512/7305/7305241.png'; // Replace with your image URL
appleImage.crossOrigin = 'Anonymous'; // Optional: For CORS if the image is from a different domain


    // Get the canvas context
    const ctx = document.getElementById('nutrientChart').getContext('2d');

    // Nutrient data
    const data = {
        labels: ['Carbs', 'Protein', 'Fats', 'Calories'],
        datasets: [{
            data: [50, 20, 15, 482], // Sample values: g, g, g, kcal
            backgroundColor: [
                'rgb(96, 165, 250)',  // Blue for Calories
                'rgb(74, 222, 128)',  // Green for Protein
                'rgb(248, 113, 113)', // Red for Fats
                '#FFC300'             // Yellow for Calories
            ],
            borderWidth: 0,
            cutout: '60%' // Makes it a donut chart
        }]
    };

    // Calculate total for percentage
    const total = data.datasets[0].data.reduce((sum, value) => sum + value, 0);

    // Chart configuration
    new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: { display: false },
                legend: {
                    position: 'bottom',
                    display: false,
                    labels: {
                        font: {
                            size: 14
                        }
                    }
                },
                datalabels: {
                    color: '#fff',
                    formatter: (value, context) => {
                        // Calculate percentage
                        const percentage = ((value / total) * 100).toFixed(1);
                        // Get label and unit
                        const label = context.chart.data.labels[context.dataIndex];
                        const unit = label === 'Calories' ? 'kcal' : 'g';
                        // Return value with unit and percentage
                        return `${percentage}%`;
                    },
                    font: {
                        weight: 'bold',
                        size: 16
                    },
                    // Optional: Adjust positioning
                    anchor: 'center',
                    align: 'center',
                    textAlign: 'center'
                },
				// Customize the tooltip
				tooltip: {
					enabled: true, // Enable tooltips
					callbacks: {
						label: function(context) {
							const label = context.label || '';
							const value = context.raw;
							const unit = label === 'Calories' ? 'kcal' : 'g';
							const percentage = ((value / total) * 100).toFixed(1);
							// Show custom value + label
							return ` ${value} ${unit}`;
						}
					}
				}
            }
        },
    plugins: [{
        beforeDraw: function(chart) {
            const ctx = chart.ctx;
            const width = chart.width;
            const height = chart.height;

            // Wait for the image to load before drawing
            if (appleImage.complete) {
                // Calculate the size of the image (e.g., 50px or scale based on chart size)
                const imageSize = Math.min(width, height) * 0.3; // 30% of the smaller dimension
                const x = width / 2 - imageSize / 2; // Center horizontally
                const y = height / 2 - imageSize / 2; // Center vertically

                // Draw the image
                ctx.drawImage(appleImage, x, y, imageSize, imageSize);
            }
        }
    }]
    });
		
		
		
		
		
		
		
		
		
		// Cholesterol chart
		function plotCholesterolChart(cholesterolData){
		
			function getColor(value) {
				// Ensure the input is within the range 0 - 100
				value = Math.max(0, Math.min(value, 100));
				
				// Calculate the red and green components based on the input value
				let red = Math.round((value * 2.55)); // Convert value to range 0-255 for red
				let green = Math.round(255 - (value * 2.55)); // Convert value to range 0-255 for green

				// Generate the hex color code
				let hexColor = `#${toHex(red)}${toHex(green)}00`; // Use blue as 0 (always)

				return hexColor;
			}

			// Helper function to convert a number to a 2-digit hex string
			function toHex(num) {
				return num.toString(16).padStart(2, '0');
			}
			
			function splitToObject(str) {
				if(!str || !str.amount || isNaN(parseInt(str.amount))) return { min: 0, max: 0, avg: 0 };
				
				if(!str.amount.includes('-')){
					return { min: parseInt(str.amount), max: parseInt(str.amount), avg: parseInt(str.amount) };
				}
				
				const parts = str.amount.split('-');
				const min = parseInt(parts[0], 10);
				const max = parseInt(parts[1], 10);
				const avg = (min + max) / 2;

				return { min: min, max: max, avg: avg };
			}
			
			// Display vitamin
			for(name in cholesterolData){
				if(typeof name !== 'string' || name.toLowerCase() !== "cholesterol") continue;
				
				let parsedValue = splitToObject(cholesterolData[name]);
				
				// Calculate cholesterol DV (percent)
				const dv = {value: 300, unit: 'mg'}; // mg
				// Calculate food daily value in percent %
				let computedPercent = parsedValue.avg / dv.value * 100;
				
				console.log(computedPercent)
				
				const ctx = document.getElementById('cholesterol-chart').getContext('2d');
				const chart = new Chart(ctx, {
					type: 'doughnut',
					data: {
						labels: ['Cholesterol', 'Remaining'],
						datasets: [{
							data: [Math.round(computedPercent), Math.round(computedPercent) >= 100 ? 0 : 100 - Math.round(computedPercent)],
							backgroundColor: [getColor(computedPercent)/*'#ff8c00'*/, '#e5e7eb'], // Orange for progress, gray for remaining
							borderWidth: 0,
							cutout: '80%' // Makes it thinner like a progress ring
						}]
					},
					options: {
						responsive: true,
						maintainAspectRatio: false,
						plugins: {
									tooltip: {
										enabled: true,
										mode: 'index', // Tooltip mode, can be 'index', 'nearest', etc.
										callbacks: {
											label: function(tooltipItem) {
												// Access data for custom display
												var label = tooltipItem.label || '';
												var data = tooltipItem.dataset.data || '';
												// Return custom tooltip string
												return label === 'Cholesterol' ? parsedValue.avg + ' mg (' + data[0] + '%)' : (parsedValue.avg > dv.value ? 0 : dv.value - parsedValue.avg) + ' mg (' + data[1] + '%)';
											}
									}
								},
							datalabels: {display: false },
							legend: { display: false },
							title: { display: false },
						},
						rotation: -90, // Start from top
						circumference: 180, // Half circle for progress
						animation: { animateRotate: true }
					},
					plugins: [{
						beforeDraw: function(chart) {
							const ctx = chart.ctx;
							const width = chart.width;
							const height = chart.height;
							const fontSize = (height / 114).toFixed(2);
							ctx.font = `${fontSize}em sans-serif`;
							ctx.textAlign = 'center';
							ctx.textBaseline = 'middle';
							ctx.fillStyle = '#4a5568';
							ctx.font = `${(fontSize * 0.8).toFixed(2)}em sans-serif`;
							ctx.fillText(parsedValue.avg + ' / ' + dv.value + ' ' + dv.unit, width / 2, height / 2 + 30);
						}
					}]
				});
			}
		}
		
		let cholesterolData = {
		  "cholesterol": {
			"amount": "100-110",
			"unit": "mg"
		  }
		};
		plotCholesterolChart(cholesterolData);
		
		
		
		
		async function plotVitaminCharts(vitaminsInFood){
		
			let response = await fetch('https://marcustansoon.github.io/PhysicsEngine.js-2D/temp/App%20Development/Calorie-Tracker/data/vitamins-minerals-daily-values.json');
			// Get Daily values for minerals and vitamins based on user age and gender
			let vitaminDailyValues = await response.json();
			
				function getVitaminDV(age, gender, vitaminName) {
				  let ageRange = "";
				  
				  // Determine the correct age range
				  if (age >= 1 && age <= 3) {
					ageRange = "1-3";
				  } else if (age >= 4 && age <= 8) {
					ageRange = "4-8";
				  } else if (age >= 9 && age <= 13) {
					ageRange = "9-13";
				  } else if (age >= 14 && age <= 18) {
					ageRange = "14-18";
				  } else if (age >= 19 && age <= 50) {
					ageRange = "19-50";
				  } else if (age >= 51) {
					ageRange = "51+";
				  } else {
					return "Invalid age";
				  }

				  // Access the vitamin data
				  const vitaminData = vitaminDailyValues[vitaminName];
				  if (!vitaminData) {
					return;
				  }

				  // Return the DV value for the given vitamin, age, and gender
				  const dvValue = vitaminData[gender][ageRange];
				  if (dvValue !== undefined) {
					return {value: dvValue, unit: vitaminData.unit};
				  } else {
					return;
				  }
				}
			
			// Vitamin Alias Names
			let vitaminAliasNames = {
				'vitamin_a' : 'vitamin_a',
				'retinol' : 'vitamin_a',
				'beta_carotene' : 'vitamin_a',
				'vitamin_c': 'vitamin_c',
				'ascorbic_acid': 'vitamin_c',
				'vitamin_b1' : 'vitamin_b1',
				'thiamine' : 'vitamin_b1',
				'vitamin_b2' : 'vitamin_b2',
				'riboflavin' : 'vitamin_b2',
				'vitamin_b3' : 'vitamin_b3',
				'niacin' : 'vitamin_b3',
				'vitamin_b5' : 'vitamin_b5',
				'pantothenic_acid' : 'vitamin_b5',
				'vitamin_b6' : 'vitamin_b6',
				'pyridoxine' : 'vitamin_b6',
				'vitamin_b7' : 'vitamin_b7',
				'biotin' : 'vitamin_b7',
				'vitamin_b9' : 'vitamin_b9',
				'folate' : 'vitamin_b9',
				'folic_acid' : 'vitamin_b9',
				'vitamin_b12' : 'vitamin_b12',
				'cobalamin' : 'vitamin_b12',
				'vitamin_e' : 'vitamin_e',
				'tocopherol' : 'vitamin_e',
				'vitamin_h' : 'vitamin_h',
				'vitamin_d' : 'vitamin_d',
				'biotin' : 'vitamin_h',
				'vitamin_k' : 'vitamin_k',
				'vitamin_p' : 'vitamin_p',
				'bioflavonoids' : 'vitamin_p',
				'vitamin_t' : 'vitamin_t',
				'tocotrienols' : 'vitamin_t',
				'calcium' : 'calcium',
				'iron' : 'iron',
				'magnesium' : 'magnesium',
				'potassium' : 'potassium',
				'zinc' : 'zinc',
				'sodium' : 'sodium',
				'phosphorus' : 'phosphorus',
				'copper' : 'copper',
				'manganese' : 'manganese',
				'iodine' : 'iodine',
				'selenium' : 'selenium',
				'chromium' : 'chromium',
				'fluoride' : 'fluoride',
				'boron' : 'boron',
				'chloride' : 'chloride',
				'vanadium' : 'vanadium',
			};
			
			function convertVitaminName(vitamin) {
				// Replace underscores with spaces, then capitalize the first letter of each word
				return vitamin
					.replace(/_/g, ' ')                      // Replace underscores with spaces
					.replace(/\b\w/g, (char) => char.toUpperCase()); // Capitalize the first letter of each word
			}
			
			function replaceSpacesAndHyphens(str) {
				return str.replace(/[\s-]/g, '_').toLowerCase();
			}
			
			function splitToObject(str) {
				if(!str || !str.amount || isNaN(parseInt(str.amount))) return { min: 0, max: 0, avg: 0 };
				
				if(!str.amount.includes('-')){
					return { min: parseInt(str.amount), max: parseInt(str.amount), avg: parseInt(str.amount) };
				}
				
				const parts = str.amount.split('-');
				const min = parseInt(parts[0], 10);
				const max = parseInt(parts[1], 10);
				const avg = (min + max) / 2;

				return { min: min, max: max, avg: avg };
			}
			
			let index = 0;
			
			// Display vitamin
			for(name in vitaminsInFood ){
				if(!vitaminAliasNames[replaceSpacesAndHyphens(name)]) continue;
				
				// Get alias name
				let aliasName = vitaminAliasNames[replaceSpacesAndHyphens(name)];
				// Get value
				let parsedValue = splitToObject(vitaminsInFood[name]);
				// Get DV from database
				let dv = getVitaminDV(23, 'male', aliasName);
				// Calculate food daily value in percent %
				let computedPercent = parsedValue.avg / dv.value * 100;
				
				// Get color code
				let color = vitaminDailyValues[aliasName].color_code;
				
				// Adjust css style
				if(index == 3){
					document.getElementById('vitamin-charts').classList.remove('grid-flow-row');
					document.getElementById('vitamin-charts').classList.add('grid-flow-col');
					document.getElementById('vitamin-charts').classList.remove('grid-cols-2');
					document.getElementById('vitamin-charts').classList.add('grid-rows-2');
				}
				
				// Make sure main container is not hidden
				document.getElementById('vitamin-main-container').classList.remove('hidden');
				
				let html = `
						<div class="max-w-32">
							<div  class="max-h-28 max-w-32">
								<canvas id="vitamin-chart-${index}"></canvas>
							</div>
							<div class="text-center text-white rounded-full" style="background-color: ${color}">
								<div>${convertVitaminName(aliasName)}</div>
							</div>
						</div>
				`;

				// Create a new div element
				let newDiv = document.createElement('div');
				newDiv.innerHTML = html;
				
				// Append the new div to the parent element
				document.getElementById('vitamin-charts').appendChild(newDiv);
				
				const ctx = document.getElementById('vitamin-chart-' + index).getContext('2d');
				
				new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [Math.round(computedPercent), computedPercent >= 100 ? 0 : 100 - Math.round(computedPercent)], // Progress and remaining
                            backgroundColor: [(color), darkenHexColor(color, 0.7)], // 70% of original brightness (30% darker)], // Chart color and light gray for remaining
                            borderWidth: 0,
                            cutout: '70%' // Creates a thinner ring effect
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: false },
                            tooltip: {
								enabled: true,
								mode: 'index', // Tooltip mode, can be 'index', 'nearest', etc.
								callbacks: {
									label: function(tooltipItem) {
										// Access data for custom display
										var label = tooltipItem.dataset.label || '';
										// Return custom tooltip string
										return ' ' + parsedValue.avg + ' / ' + dv.value + ' ' + dv.unit + ' (' + Math.round(computedPercent) + '%)';
									},
									title: function(tooltipItem) {
										// Example of changing the tooltip title (index of data point)
										return convertVitaminName(aliasName) + tooltipItem[0].label;
									}
								}
                            },
                            datalabels: {
                                display: false // Disable default data labels to use custom text
                            }
                        },
                        rotation: -90, // Start from top
                        circumference: 180, // Half circle for ring effect
                        animation: { animateRotate: false }
                    },
					plugins: [{
						beforeDraw: function(chart) {
							const ctx = chart.ctx;
							const width = chart.width;
							const height = chart.height;
							const fontSize = (height / 114).toFixed(2);
							ctx.font = `${fontSize}em sans-serif`;
							ctx.textAlign = 'center';
							ctx.textBaseline = 'middle';
							ctx.fillStyle = '#4a5568';
							ctx.fillText(' ' + parsedValue.avg + ' ' + dv.unit, width / 2, height / 2 + 20);
							//ctx.fillText(Math.round(computedPercent) + '%', width / 2, height / 2 + 20);
						}
					}]
                });
				
				index++;
			}
			
		}
		
		// Vitamins in food
			let vitaminsInFood = {
				"iron": {
				  "amount": "2-3",
				  "unit": "mg"
				},
				"zinc": {
				  "amount": "3-5",
				  "unit": "mg"
				},
				"vitamin_B12": {
				  "amount": "2-3",
				  "unit": "mcg"
				},
				"vitamin_c": {
				  "amount": "23",
				  "unit": "mcg"
				},
				"vitamin_b3": {
				  "amount": "23",
				  "unit": "mcg"
				},
				"vitamin_b6": {
				  "amount": "23",
				  "unit": "mcg"
				},
				"calcium": {
				  "amount": "150-250",
				  "unit": "mg"
				}
			}
			
			plotVitaminCharts(vitaminsInFood);
    </script>
	
</body>
</html>
