// server.js
const express = require('express');
const { createCanvas } = require('canvas');
const fetch = require('node-fetch');
const fs = require("fs");
const HttpsProxyAgent = require('https-proxy-agent');

const app = express();
app.use(express.json());


function createImageFile(name, base64String){
		
	// Remove metadata (if present)
	const base64Data = base64String.replace(/^data:image\/\w+;base64,/, "");
	
	// Write the file
	fs.writeFile(name, base64Data, { encoding: "base64" }, (err) => {
		if (err) {
			console.error("❌ Error saving image:", err);
		} else {
			console.log("✅ Image saved successfully:", name);
		}
	});
}




// Encode string digits into proper pixel data
function getEncodedPixelData(char) {
    let pixelData;
    switch (char) {
        case '0': pixelData = 0; break;
        case '1': pixelData = 1; break;
        case '2': pixelData = 2; break;
        case '3': pixelData = 3; break;
        case '4': pixelData = 4; break;
        case '5': pixelData = 5; break;
        case '6': pixelData = 6; break;
        case '7': pixelData = 7; break;
        case '8': pixelData = 8; break;
        case '9': pixelData = 9; break;
        case '.': pixelData = 10; break;
        case '-': pixelData = 11; break;
        case ',': pixelData = 12; break;
        case ';': pixelData = 13; break;
        default: pixelData = 15; break;
    }
    return pixelData;
}

// Decode pixel data into proper digits (string)
function getDecodedPixelData(rawPixelData) {
    let pixelData;
    switch (rawPixelData) {
        case 0: pixelData = '0'; break;
        case 1: pixelData = '1'; break;
        case 2: pixelData = '2'; break;
        case 3: pixelData = '3'; break;
        case 4: pixelData = '4'; break;
        case 5: pixelData = '5'; break;
        case 6: pixelData = '6'; break;
        case 7: pixelData = '7'; break;
        case 8: pixelData = '8'; break;
        case 9: pixelData = '9'; break;
        case 10: pixelData = '.'; break;
        case 11: pixelData = '-'; break;
        case 12: pixelData = ','; break;
        case 13: pixelData = ';'; break;
        default: pixelData = ' '; break;
    }
    return pixelData;
}


async function uploadImageToImgur(base64Image, accessToken, description) {
    const url = 'https://api.imgur.com/3/image';

    // Read image file as a Base64 encoded string (using FileReader)
    //const imageData = await fetch(imagePath).then(res => res.arrayBuffer());
    //const base64Image = btoa(String.fromCharCode(...new Uint8Array(imageData)));

    const postData = {
        description: description,
        image: base64Image.split(',')[1], // Base64-encoded image data
    };

    const headers = {
        "Authorization": `Bearer ${accessToken}`,
        "Content-Type": "application/json"
    };

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(postData)
        });

        const result = await response.json();
        return result;
    } catch (error) {
        console.error('Error uploading image:', error);
        return { success: false, error: error.message };
    }
}

async function addImageToImgurAlbum(imageId, albumId, accessToken) {
    const url = `https://api.imgur.com/3/album/${albumId}/add`;

    const postData = {
        ids: [imageId] // Array of image IDs to be added
    };

    const headers = {
        "Authorization": `Bearer ${accessToken}`,
        "Content-Type": "application/json"
    };

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(postData)
        });

        const result = await response.json();
        const httpCode = response.status;

        if (httpCode === 200) {
            return {
                success: true,
                data: result.data
            };
        } else {
            return {
                success: false,
                error: result.data.error || `HTTP ${httpCode}: Unknown error`,
                raw_response: result
            };
        }
    } catch (error) {
        console.error('Error adding image to album:', error);
        return { success: false, error: error.message };
    }
}

async function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

const fetchWithTimeout = (url, options, timeout = 10000) => {
    return Promise.race([
        fetch(url, options),
        new Promise((_, reject) => setTimeout(() => reject(new Error('Fetch timeout')), timeout))
    ]);
};















let tickers =[
    "ORN",
    "ORRF",
    "OS",
    "OSBC",
    "OSCR",
    "OSIS",
    "OSK",
    "OSPN",
    "OSRH",
    "OSS",
    "OST",
    "OSUR",
    "OSW",
    "OTEX",
    "OTIS",
    "OTLK",
    "OTLY",
    "OTRK",
    "OTTR",
    "OUST",
    "OUT",
    "OVBC",
    "OVID",
    "OVLY",
    "OVV",
    "OWL",
    "OWLT",
    "OXBR",
    "OXM",
    "OXSQ",
    "OXY",
    "OZK",
    "OZON",/*
    "PAA",
    "PAAS",
    "PAC",
    "PACB",
    "PACD",
    "PACK",
    "PACS",
    "PAG",
    "PAGP",
    "PAGS",
    "PAHC",
    "PAIYY",
    "PAL",
    "PALI",
    "PAM",
    "PAMT",
    "PANL",
    "PANW",
    "PAR",
    "PARA",
    "PARAA",
    "PARR",
    "PASG",
    "PATH",
    "PATK",
    "PAVM",
    "PAVS",
    "PAX",
    "PAY",
    "PAYC",
    "PAYO",
    "PAYS",
    "PAYX",
    "PB",
    "PBA",
    "PBBK",
    "PBF",
    "PBFS",
    "PBH",
    "PBHC",
    "PBI",
    "PBLA",
    "PBM",
    "PBPB",
    "PBR",
    "PBR.A",
    "PBT",
    "PBYI",
    "PC",
    "PCAR",
    "PCB",
    "PCG",
    "PCH"*/
]

let jsonTickers = {};
let jsonImages = {};

const albumId = 'G0DQ6Hk'; // Imgur album ID
const accessToken = 'ffc8fd46eb1f0d2bf28d099af47f421eb574bfa3'; // Imgur access token

//tickers = ["IBM"]



// Proxy list
const proxyList = [



	'http://halusngj:iqii2z5mv1ke@38.154.227.167:5868',
	"http://tkifgotd:h5842xrc9zzm@38.154.227.167:5868",
	"http://tkifgotd:h5842xrc9zzm@38.153.152.244:9594",
	"http://tkifgotd:h5842xrc9zzm@86.38.234.176:6630",
	"http://tkifgotd:h5842xrc9zzm@173.211.0.148:6641",
	"http://tkifgotd:h5842xrc9zzm@161.123.152.115:6360",
	
	"http://tkifgotd:h5842xrc9zzm@216.10.27.159:6837",
	"http://tkifgotd:h5842xrc9zzm@154.36.110.199:6853",
	"http://tkifgotd:h5842xrc9zzm@45.151.162.198:6600",
	"http://tkifgotd:h5842xrc9zzm@185.199.229.156:7492",
	"http://tkifgotd:h5842xrc9zzm@185.199.228.220:7300",

  
  "103.166.104.170:8765",
  "54.221.142.167:3128",
  "141.95.238.126:8080",
  "103.213.218.224:15947",
  "117.74.65.207:443",
  "114.231.75.96:8089",
  "78.155.218.75:3128",
  "49.70.172.30:2324",
  "154.68.34.20:3128",
  "92.58.181.171:1194",
  "200.250.131.218:80",
  "103.19.59.168:1080",
  "60.183.79.105:8085",
  "104.19.255.66:80",
  "72.195.114.169:4145",
  "47.91.29.151:33427",
  "103.17.90.6:5678",
  "95.159.105.21:8080",
  "38.22.17.50:3128",
  "47.251.43.115:33333",
  "202.162.212.165:4153",
  "190.92.159.141:36666",
  "174.77.111.197:4145",
  "166.62.85.184:21946",
  "85.112.71.208:8080",
  "159.100.20.206:27866",
  "4.155.2.13:9401",
  "14.189.160.138:1452",
  "38.152.72.158:2335",
  "213.159.67.176:3128",
  "43.135.185.22:13001",
  "116.132.6.222:8081",
  "113.22.172.159:10009",
  "181.204.113.252:11211",
  "185.255.4.172:1111",
  "190.211.4.139:999",
  "188.117.108.76:3128",
  "172.167.161.8:8080",
  "49.146.50.237:8080",
  "175.139.233.79:80",
  "191.102.82.83:4153",
  "200.174.198.86:8888",
  "72.44.34.149:8080",
  "103.117.192.14:80",
  "27.189.134.90:8089",
  "8.213.156.191:8080",
  "189.22.234.40:80",
  "113.22.172.147:10009",
  "111.1.61.47:3128",
  "51.158.105.94:31826",
  "49.51.41.61:13001",
  "8.213.156.191:8888",
  "38.152.72.209:2335",
  "103.228.243.144:8085",
  "103.131.18.194:8080",
  "103.181.254.105:8080",
  "45.189.118.51:999",
  "43.153.42.39:13001",
  "102.219.208.86:3346",
  "103.83.224.176:8080",
  "110.43.221.121:7088",
  "45.4.1.208:999",
  "178.66.110.237:8080",
  "170.106.181.226:13001",
  "38.156.14.195:999",
  "103.82.38.194:8888",
  "36.136.27.2:4999",
  "103.154.230.130:8080",
  "213.239.221.24:8888",
  "90.156.200.4:3128",
  "38.152.72.254:2335",
  "113.108.13.120:4433",
  "4.155.2.13:9400",
  "51.83.116.6:10255",
  "38.253.84.93:999",
  "38.65.172.81:999",
  "8.209.213.244:3389",
  "117.5.16.39:5101",
  "49.76.17.226:8089",
  "103.126.119.252:8181",
  "113.22.172.141:10009",
  "200.106.124.64:999",
  "209.14.98.5:8080",
  "183.164.226.215:1080",
  "94.154.200.2:5678",
  "186.215.43.224:3128",
  "157.10.97.17:9988",
  "172.232.170.27:31280",
  "119.28.49.85:4780",
  "185.26.201.73:8080",
  "27.189.129.156:8089",
  "124.83.102.56:8082",
  "203.114.66.85:59876",
  "131.196.82.70:999",
  "1.54.115.179:8080",
  "103.163.171.201:3265",
  "220.169.194.49:12666",
  "96.9.83.134:8080",
  "186.194.160.146:999",
  "43.153.102.53:13001",
  "183.88.224.86:8080",
  "168.194.0.246:252",
  "135.181.154.225:80",
  "67.43.236.20:25523",
  "8.221.139.222:8108",
  "198.12.152.216:57294",
  "190.103.177.131:80",
  "47.91.121.127:8443",
  "223.206.122.157:8080",
  "103.164.213.78:8088",
  "103.95.150.13:8080",
  "117.74.65.207:443",
  "183.88.212.184:8080",
  "34.143.143.61:7777",
  "24.144.94.90:8080",
  "181.215.253.112:5001",
  "190.61.61.210:999",
  "43.153.92.57:13001",
  "47.254.28.155:8081",
  "187.62.241.136:8080",
  "47.91.121.127:10000",
  "176.88.175.203:8080",
  "125.25.125.154:8080",
  "38.41.4.165:999",
  "43.153.4.199:13001",
  "44.205.145.200:8080",
  "179.48.251.190:8081",
  "190.8.34.211:999",
  "49.51.232.89:13001",
  "181.188.238.144:999",
  "101.51.109.68:8080",
  "47.91.29.151:8443",
  "154.117.220.13:3128",
  "192.111.130.5:17002",
  "113.22.172.149:10009",
  "16.16.7.119:80",
  "191.252.204.220:8080",
  "119.3.113.152:9094",
  "131.100.51.145:999",
  "43.251.84.242:8080",
  "113.163.23.113:10001",
  "103.48.68.83:83",
  "181.198.1.84:999",
  "103.163.171.202:5126",
  "94.75.76.3:8080",
  "38.152.72.160:2335",
  "43.153.39.191:13001",
  "139.59.1.14:80",
  "119.3.113.150:9094",
  "89.110.78.230:80",
  "80.76.34.3:3128",
  "165.232.129.150:80",
  "165.16.27.36:1976",
  "45.140.143.77:18080",
  "43.153.36.97:13001",
  "179.43.8.16:8088",
  "49.48.82.28:8080",
  "218.77.183.214:5224",
  "116.102.106.229:8080",
  "85.117.56.147:8080",
  "41.65.162.72:1976",
  "47.56.110.204:8990",
  "27.189.129.21:8089",
  "164.90.197.165:3128",
  "195.177.217.131:19663",
  "144.126.136.76:41628",
  "54.37.207.54:3128",
  "44.215.100.135:8118",
  "114.224.143.254:8089",
  "8.211.49.86:1080",
  "103.151.227.74:8080",
  "38.194.233.82:999",
  "67.43.236.19:3811",
  "115.231.181.40:8128",
  "180.114.169.254:8089",
  "41.139.234.127:8080",
  "43.135.132.181:13001",
  "43.130.48.100:13001",
  "27.64.218.85:4005",
  "36.94.39.146:8080",
  "141.11.103.136:8080",
  "91.189.237.78:8080",
  "27.189.132.152:8089",
  "54.37.214.253:8080",
  "38.45.45.130:999",
  "103.48.70.105:83",
  "184.82.48.41:8080",
  "9.223.187.19:3128",
  "113.22.172.142:10009",
  "222.92.76.4:8083",
  "103.247.21.55:4598",
  "188.117.108.73:9480",
  "183.214.203.219:8060",
  "1.20.227.66:4145",
  "43.153.46.52:13001",
  "143.198.35.225:3128",
  "72.10.164.178:31785",
  "117.74.65.207:80",
  "114.9.27.142:8080",
  "103.162.66.10:8080",
  "117.82.227.185:8089",
  "175.139.233.76:80",
  "146.190.53.45:3128",
  "185.229.241.132:8880",
  "222.186.21.30:6789",
  "43.153.16.223:13001",
  "54.38.179.162:21037",
  "186.145.192.251:5678",
  "43.153.98.220:13001",
  "203.110.145.82:63128",
  "13.228.125.72:8888",
  "47.121.183.107:9080",
  "188.117.108.66:9443",
  "117.74.65.207:80",
  "103.122.137.68:8080",
  "16.24.171.118:80",
  "170.106.168.41:7654",
  "186.96.66.144:999",
  "103.106.112.166:1234",
  "195.87.136.2:5331",
  "66.211.155.34:8080",
  "190.215.109.74:8080",
  "219.138.76.100:63000",
  "43.153.61.52:13001",
  "103.148.49.195:8080",
  "4.155.2.13:9443",
  "123.202.99.111:8081",
  "171.6.136.15:8080",
  "158.101.112.45:8080",
  "202.154.18.1:4995",
  "191.7.196.128:8080",
  "187.189.18.86:999",
  "114.6.27.84:8520",
  "160.226.138.129:5678",
  "38.194.254.30:999",
  "119.252.173.26:8080",
  "103.152.100.221:8080",
  "171.228.123.143:5101",
  "92.247.12.136:9510",
  
  
  "170.106.192.157:13001",
  "45.92.177.60:8080",
  "170.106.82.224:13001",
  "67.43.227.226:17415",
  "170.106.135.2:13001",
  "162.223.90.130:80",
  "43.153.22.230:13001",
  "43.135.161.247:13001",
  "43.153.11.82:13001",
  "166.62.35.102:45775",
  "54.37.214.253:80",
  "138.68.60.8:80",
  "43.153.50.230:13001",
  "179.48.251.190:8080",
  "114.229.213.245:8089",
  "200.174.198.86:8888",
  "43.153.78.185:13001",
  "212.33.205.55:3128",
  "27.189.131.216:8089",
  "54.227.223.235:3128",
  "119.3.113.152:9094",
  "38.152.72.203:2335",
  "72.10.160.90:21265",
  "27.189.130.20:8089",
  "130.61.114.175:3128",
  "42.114.226.95:10009",
  "84.10.62.238:8087",
  "200.35.148.202:999",
  "4.252.13.78:43083",
  "188.117.108.67:443",
  "188.117.108.76:3128",
  "38.152.72.157:2335",
  "190.94.212.216:999",
  "117.81.238.93:8089",
  "178.63.237.145:8080",
  "43.153.28.45:13001",
  "188.117.108.71:3128",
  "77.221.141.93:6060",
  "190.61.55.140:999",
  "103.181.255.149:8080",
  "170.106.83.149:13001",
  "189.22.234.33:80",
  "200.94.102.10:999",
  "20.27.14.220:8561",
  "47.90.205.231:33333",
  "8.220.205.172:1337",
  "194.163.183.242:3128",
  "103.83.236.6:8082",
  "184.82.48.41:8080",
  "103.131.18.194:8080",
  "38.54.71.67:80",
  "114.229.213.223:8089",
  "144.126.216.57:80",
  "188.132.222.4:8080",
  "78.108.108.9:8080",
  "37.114.37.82:2019",
  "117.82.93.242:8089",
  "180.191.36.250:8081",
  "38.41.4.165:999",
  "61.164.204.130:4999",
  "187.202.210.3:3128",
  "111.72.196.50:2324",
  "18.167.141.12:8888",
  "177.234.245.249:32213",
  "103.154.230.190:8080",
  "43.135.160.237:13001",
  "27.64.218.85:4009",
  "38.45.46.2:6332",
  "45.95.234.116:3128",
  "188.117.108.67:80",
  "43.135.166.82:13001",
  "115.87.207.192:8213",
  "149.86.159.4:8080",
  "43.153.11.118:13001",
  "117.5.23.165:4001",
  "123.30.154.171:7777",
  "43.153.77.83:13001",
  "150.109.37.211:3128",
  "43.153.94.8:13001",
  "103.175.46.203:3125",
  "114.224.142.222:8089",
  "188.117.108.72:3128",
  "49.76.17.166:8089",
  "122.52.44.243:5050",
  "67.43.236.19:4829",
  "43.130.3.92:13001",
  "204.199.139.124:999",
  "195.154.43.198:64974",
  "58.243.224.244:8085",
  "59.53.80.122:10024",
  "43.153.106.210:13001",
  "38.152.72.164:2335",
  "23.82.137.161:80",
  "43.130.29.139:13001",
  "38.250.119.84:999",
  "89.46.249.253:53018",
  "27.189.135.162:8089",
  "43.153.79.9:13001",
  "72.10.160.90:9499",
  "38.152.72.236:2335",
  "114.224.142.86:8089",
  "188.117.108.68:9443",
  "182.71.12.186:8080",
  "43.153.16.223:13001",
  "190.52.100.211:999",
  "43.153.103.45:13001",
  "5.53.23.106:8080",
  "103.242.105.177:8181",
  "78.38.99.74:8080",
  "47.251.43.115:33333",
  "93.126.6.68:3128",
  "200.41.170.212:11201",
  "170.106.64.217:13001",
  "58.11.66.235:8888",
  "27.79.165.221:16000",
  "43.153.46.52:13001",
  "67.43.227.227:20663",
  "43.130.47.163:13001",
  "181.119.86.186:999",
  "186.96.66.145:999",
  "43.130.40.28:13001",
  "192.111.137.35:4145",
  "181.78.82.210:999",
  "67.43.228.251:3103",
  "42.114.226.95:10030",
  "77.83.241.93:55555",
  "34.143.143.61:7777",
  "170.106.196.118:13001",
  "142.93.209.163:3128",
  "47.88.18.204:8023",
  "72.10.160.90:27233",
  "117.80.190.191:8089",
  "103.132.40.10:8780",
  "38.152.72.232:2335",
  "103.247.23.67:2022",
  "188.125.167.67:8080",
  "170.106.74.95:13001",
  "170.106.173.197:13001",
  "46.47.197.210:3128",
  "47.238.130.212:9080",
  "119.95.107.16:8081",
  "103.125.174.29:7777",
  "170.106.99.182:13001",
  "103.184.180.204:1313",
  "221.225.67.251:8089",
  "82.213.29.203:19000",
  "27.64.218.85:4002",

	'dmfudori:ycoetjksk903@38.154.227.167:5868',
	'dmfudori:ycoetjksk903@38.153.152.244:9594',
	'dmfudori:ycoetjksk903@86.38.234.176:6630',
	'dmfudori:ycoetjksk903@173.211.0.148:6641',
	'dmfudori:ycoetjksk903@161.123.152.115:6360',
	'dmfudori:ycoetjksk903@216.10.27.159:6837',
	'dmfudori:ycoetjksk903@154.36.110.199:6853',
	'dmfudori:ycoetjksk903@45.151.162.198:6600',
	'dmfudori:ycoetjksk903@185.199.229.156:7492',
	'dmfudori:ycoetjksk903@185.199.228.220:7300',


	'http://halusngj:iqii2z5mv1ke@38.154.227.167:5868',
	"http://tkifgotd:h5842xrc9zzm@38.154.227.167:5868",
	"http://tkifgotd:h5842xrc9zzm@38.153.152.244:9594",
	"http://tkifgotd:h5842xrc9zzm@86.38.234.176:6630",
	"http://tkifgotd:h5842xrc9zzm@173.211.0.148:6641",
	"http://tkifgotd:h5842xrc9zzm@161.123.152.115:6360",
	
	"http://tkifgotd:h5842xrc9zzm@216.10.27.159:6837",
	"http://tkifgotd:h5842xrc9zzm@154.36.110.199:6853",
	"http://tkifgotd:h5842xrc9zzm@45.151.162.198:6600",
	"http://tkifgotd:h5842xrc9zzm@185.199.229.156:7492",
	"http://tkifgotd:h5842xrc9zzm@185.199.228.220:7300",

    "43.130.32.94:13001",
    "49.51.249.217:13001",
    "68.1.210.163:4145",
    "180.112.41.218:8089",
    "43.153.7.172:13001",
    "221.167.167.82:3128",
    "203.68.189.2:8080",
    "43.153.11.82:13001",
    "89.58.45.94:39393",
    "72.10.160.91:11749",
    "43.153.103.45:13001",
    "79.127.158.225:8082",
    "49.51.41.61:13001",
    "170.106.80.237:13001",
    "45.123.142.42:8181",
    "43.135.132.181:13001",
    "37.189.70.254:8080",
    "170.106.140.154:13001",
    "174.64.199.79:4145",
    "170.106.117.36:13001",
    "202.21.115.202:4153",
    "221.231.13.198:1080",
    "113.160.132.195:8080",
    "162.55.95.91:19310",
    "162.241.45.22:61312",
    "158.255.77.169:80",
    "209.121.164.50:31147",
    "43.153.25.42:13001",
    "219.135.229.196:7890",
    "43.153.94.60:13001",
    "40.76.209.52:3128",
    "117.80.190.166:8089",
    "43.153.25.185:13001",
    "67.43.236.19:29293",
    "121.234.73.213:9002",
    "170.106.192.157:13001",
    "59.53.80.122:10024",
    "45.87.68.7:15321",
    "45.129.141.143:3128",
    "200.98.200.87:25000",
    "192.111.129.145:16894",
    "134.122.43.203:56442",
    "43.153.39.191:13001",
    "114.219.174.57:8089",
    "189.22.234.33:80",
    "51.158.105.94:31826",
    "38.51.243.81:999",
    "58.209.137.137:8089",
    "78.26.146.59:443",
    "43.153.92.210:13001",
    "43.153.48.129:13001",
    "24.37.245.42:51056",
    "153.127.195.58:4444",
    "124.106.173.56:8082",
    "43.153.79.9:13001",
    "117.74.65.207:9001",
    "167.71.15.219:12336",
    "47.254.36.213:45",
    "103.105.86.46:8090",
    "13.228.125.72:8888",
    "47.88.18.204:8023",
    "38.152.72.181:2335",
    "170.106.198.32:13001",
    "109.224.12.170:52015",
    "5.79.253.73:8081",
    "27.147.195.170:58080",
    "84.39.112.144:3128",
    "170.106.83.149:13001",
    "189.22.234.39:80",
    "103.167.68.90:8181",
    "43.153.14.2:13001",
    "103.146.170.9:5678",
    "65.109.92.51:19509",
    "120.28.168.116:8082",
    "177.234.217.42:999",
    "170.106.64.187:13001",
    "49.51.34.18:13001",
    "4.145.89.88:8080",
    "43.152.72.7:13001",
    "45.73.0.118:5678",
    "67.43.227.226:32605",
    "188.117.108.66:443",
    "110.43.221.121:7088",
    "49.51.38.113:13001",
    "104.42.10.253:3128",
    "54.37.214.253:8080",
    "97.74.87.226:80",
    "117.80.188.14:8089",
    "49.51.232.89:13001",
    "23.131.56.188:999",
    "45.189.116.214:8889",
    "43.153.66.252:13001",
    "209.14.98.5:8080",
    "123.30.154.171:7777",
    "43.135.130.124:13001",
    "170.106.107.197:13001",
    "5.75.197.16:10602",
    "43.153.16.223:13001",
    "43.153.98.107:13001",
    "158.178.246.35:80",
    "114.218.165.51:8089",
    "220.169.194.49:12666",
    "128.199.202.122:3128",
    "14.177.13.221:8080",
    "49.51.197.116:13001",
    "159.203.61.169:8080",
    "59.152.104.193:8080",
    "190.52.100.107:999",
    "67.43.236.18:10177",
    "43.135.130.88:13001",
    "47.254.36.213:8080",
    "176.119.159.213:3128",
    "43.130.2.30:13001",
    "49.51.72.228:13001",
    "105.174.43.194:8080",
    "103.163.244.212:83",
    "36.95.82.69:8080",
    "201.93.159.234:4145",
    "103.173.141.9:8080",
    "173.212.237.43:6873",
    "185.136.162.120:8888",
    "170.78.144.41:8080",
    "42.12.45.81:3128",
    "59.37.95.35:8072",
    "188.117.108.73:3128",
    "181.48.243.194:4153",
    "42.114.226.95:10006",
    "103.247.23.28:9223",
    "117.82.93.254:8089",
    "188.117.108.71:80",
    "191.252.204.220:8080",
    "43.135.136.84:13001",
    "43.156.38.109:888",
    "188.117.108.68:80",
    "43.135.129.111:13001",
    "188.117.108.71:3128",
    "98.64.128.182:3128",
    "43.130.37.196:13001",
    "103.36.35.251:5678",
    "61.144.97.200:1080",
    "188.117.108.76:3128",
    "38.191.208.11:999",
    "43.153.43.169:13001",
    "46.36.65.117:1080",
    "154.113.170.129:5678",
    "91.192.241.139:3129",
    "171.237.124.227:1007",
    "38.65.172.81:999",
    "43.153.102.53:13001",
    "43.159.138.46:13001",
    "45.140.143.77:18080",
    "43.153.65.34:13001",
    "79.127.158.225:8080",
    "100.51.242.197:8081",
    "43.153.16.91:13001",
    "67.43.236.22:10177",
    "103.189.110.50:7200",
    "78.46.212.196:1204",
    "196.204.83.237:1981",
    "81.201.62.152:80",
    "103.133.61.160:8080",
    "43.135.172.170:13001",
    "138.121.15.230:999",
    "8.215.3.250:8008",
    "38.52.208.2:999",
    "38.242.202.236:8080",
    "47.238.134.126:80",
    "186.96.68.62:999",
    "170.106.99.182:13001",
    "58.84.16.214:1231",
    "143.244.143.71:3128",
    "43.153.100.212:13001",
    "244.38.54.68:80",
    "78.186.98.171:1080",
    "103.227.187.3:6080",
	
	
    "170.106.83.149:13001",
    "188.117.108.67:443",
    "134.119.214.69:16034",
    "80.249.112.166:80",
    "103.240.101.30:8080",
    "103.82.132.103:18209",
    "67.43.236.18:22789",
    "102.209.191.10:8080",
    "188.117.108.73:3128",
    "47.91.115.179:9098",
    "114.229.213.228:8089",
    "202.74.48.66:1088",
    "85.10.199.48:80",
    "190.97.238.81:999",
    "87.248.129.32:80",
    "131.255.56.169:9292",
    "144.126.216.57:80",
    "142.93.202.130:3128",
    "175.139.233.78:80",
    "67.43.236.18:28621",
    "91.107.154.214:80",
    "181.119.94.16:999",
    "137.66.45.239:80",
    "170.106.99.182:13001",
    "66.94.108.138:3128",
    "128.199.202.122:80",
    "170.106.143.168:13001",
    "103.249.117.180:3128",
    "38.51.243.81:999",
    "170.106.184.49:13001",
    "43.130.39.183:13001",
    "144.139.210.56:80",
    "184.168.121.153:9577",
    "162.214.154.177:48542",
    "43.153.117.40:13001",
    "181.204.81.181:999",
    "119.3.113.150:9094",
    "36.74.120.240:8080",
    "188.132.150.214:8085",
    "58.248.175.134:9401",
    "201.186.41.98:999",
    "103.210.35.183:8080",
    "118.99.123.232:8888",
    "47.91.115.179:3128",
    "72.10.160.90:28895",
    "43.135.130.198:13001",
    "170.106.192.157:13001",
    "221.202.27.194:10810",
    "43.130.17.84:13001",
    "47.88.18.204:8023",
    "43.135.149.15:13001",
    "170.106.107.101:13001",
    "103.124.196.134:8080",
    "43.130.62.137:13001",
    "190.239.220.177:999",
    "103.177.176.62:8080",
    "5.75.197.16:10602",
    "27.189.133.42:8089",
    "197.96.157.93:8080",
    "103.165.155.147:8080",
    "43.135.136.84:13001",
    "8.213.129.15:8058",
    "124.104.136.232:5050",
    "93.177.126.79:8088",
    "41.33.203.238:1975",
    "123.127.4.247:85",
    "170.106.110.139:13001",
    "43.153.32.146:13001",
    "171.237.121.209:1006",
    "78.46.212.196:1404",
    "82.213.29.203:19000",
    "77.236.203.106:19500",
    "158.178.246.35:80",
    "43.135.130.124:13001",
    "62.201.217.194:8080",
    "67.43.227.227:30451",
    "2.180.31.98:8035",
    "131.100.49.73:999",
    "88.248.190.198:8080",
    "89.111.175.13:3128",
    "116.254.99.14:8080",
    "43.153.25.185:13001",
    "1.160.0.68:8081",
    "172.167.161.8:8080",
    "43.135.162.60:13001",
    "38.9.48.214:8080",
    "188.117.108.76:3128",
    "43.153.79.9:13001",
    "170.106.170.175:13001",
    "91.107.186.37:80",
    "176.119.159.213:3128",
    "157.10.97.119:8181",
    "171.237.122.99:1005",
    "188.117.108.66:443",
    "188.117.108.71:9480",
    "188.117.108.68:80",
    "4.155.2.13:80",
    "38.54.71.67:80",
    "189.84.157.177:3126",
    "189.22.234.32:80",
    "114.4.200.222:5678",
	
"38.180.2.107:3128",
    "195.219.98.27:5678",
    "49.51.245.200:13001",
    "219.65.73.81:80",
    "49.51.202.75:13001",
    "178.79.165.164:35502",
    "43.153.69.199:13001",
    "159.203.61.169:3128",
    "43.135.139.239:13001",
    "43.153.118.161:13001",
    "85.25.93.136:5566",
    "192.252.208.67:14287",
    "43.130.57.165:13001",
    "49.51.75.54:13001",
    "43.153.14.2:13001",
    "36.67.147.222:4153",
    "129.226.155.235:8080",
    "119.3.113.152:9094",
    "38.54.71.67:80",
    "185.229.241.132:8880",
    "142.54.239.1:4145",
    "43.153.50.230:13001",
    "199.58.184.97:4145",
    "184.178.172.14:4145",
    "43.153.100.6:13001",
    "79.127.158.225:8080",
    "220.197.166.216:10801",
    "184.178.172.18:15280",
    "15.235.10.31:28003",
    "67.43.228.251:26539",
    "158.69.118.135:38080",
    "67.43.228.252:4361",
    "170.106.140.154:13001",
    "170.106.64.187:13001",
    "170.106.194.126:13001",
    "8.211.194.78:443",
    "49.51.203.88:13001",
    "47.251.43.115:33333",
    "43.135.154.71:13001",
    "43.135.183.46:13001",
    "184.181.217.210:4145",
    "197.96.157.93:8080",
    "43.130.58.21:13001",
    "170.106.183.91:13001",
    "104.207.39.233:3128",
    "123.18.4.2:10009",
    "43.135.137.152:13001",
    "5.160.224.146:3128",
    "200.174.198.86:8888",
    "43.159.139.58:13001",
    "34.143.143.61:7777",
    "170.106.106.9:13001",
    "67.43.228.250:31695",
    "43.130.9.70:13001",
    "49.67.131.201:1080",
    "185.233.119.116:8080",
    "103.171.255.60:8080",
    "103.156.74.154:8080",
    "158.255.77.169:80",
    "8.211.194.78:6379",
    "49.156.44.130:55443",
    "200.35.148.202:999",
    "202.154.37.162:8080",
    "43.153.79.15:13001",
    "181.49.177.198:8080",
    "221.231.13.198:1080",
    "43.153.79.9:13001",
    "114.231.73.90:1080",
    "82.149.196.90:2080",
    "195.66.189.58:81",
    "46.47.197.210:3128",
    "43.153.27.172:13001",
    "9.163.145.93:3128",
    "103.40.121.88:8189",
    "60.248.77.86:555",
    "43.153.28.45:13001",
    "188.132.222.46:8080",
    "49.51.34.18:13001",
    "190.8.164.25:8086",
    "4.145.89.88:8080",
    "9.223.187.19:3128",
    "103.163.103.64:8080",
    "43.130.61.237:13001",
    "27.79.82.62:15166",
    "190.0.50.38:8080",
    "38.162.25.64:3128",
    "185.208.102.182:8080",
    "43.135.179.180:13001",
    "64.188.228.165:443",
    "171.100.182.11:80",
    "170.106.168.41:7654",
    "104.238.37.198:6755",
    "80.209.243.231:8443",
    "117.80.188.25:8089",
    "181.78.6.219:8080",
    "37.156.46.209:8080",
    "184.168.121.153:41243",
    "170.106.106.138:13001",
    "49.51.75.240:13001",
    "27.72.244.228:8080",
    "45.140.143.77:18080",
    "184.181.217.213:4145",
    "38.45.43.6:999",
    "43.153.23.65:13001",
    "115.245.46.173:8080",
    "103.134.246.102:3172",
    "142.93.202.130:3128",
    "177.101.0.199:8080",
    "101.66.194.93:8085",
    "43.135.130.124:13001",
    "170.106.169.110:13001",
    "103.48.71.162:84",
    "160.19.18.59:8910",
    "49.88.254.98:3328",
    "4.155.2.13:9443",
    "125.209.110.83:39617",
    "188.117.108.67:443",
    "179.60.53.28:999",
    "111.1.61.47:3128",
    "4.155.2.13:80",
    "43.153.23.64:13001",
    "38.52.158.76:999",
    "192.46.229.201:3310",
    "114.80.32.8:3081",
    "104.129.194.44:10865",
    "3.86.92.170:8080",
    "119.3.113.151:9094",
    "103.17.90.6:5678",
    "36.95.22.27:8080",
    "104.129.194.43:11263",
    "27.189.133.226:8089",
    "125.26.15.224:8080",
    "103.22.99.21:8883",
    "103.162.54.250:8066",
    "104.129.194.43:11728",
    "43.155.196.88:9090",
    "72.44.34.149:8080",
    "201.91.82.155:3128",
    "67.213.212.39:58116",
    "81.169.213.169:8888",
    "43.153.27.33:13001",
    "36.64.181.82:8080",
    "189.1.220.189:8080",
    "43.153.36.97:13001",
    "181.209.111.148:999",
    "36.95.78.156:8080",
    "207.55.243.54:64403",
    "155.54.239.64:80",
    "43.159.138.46:13001",
    "51.161.56.52:80",
    "43.248.186.56:8888",
    "58.69.143.223:41890",
    "118.173.230.149:1080",
    "15.235.10.43:28003",
    "79.127.158.225:8082",
    "77.221.141.36:53647",
    "80.249.112.166:80",
    "114.80.38.120:3081",
    "49.51.73.61:13001",
    "200.69.92.98:999",
    "203.76.98.21:45958",
    "181.174.228.96:999",
    "170.106.67.179:13001",
    "4.155.2.13:9401",
    "1.55.35.55:3128",
    "193.105.62.11:58973",
    "79.127.158.225:8081",
    "62.103.66.18:3128",
    "43.135.129.111:13001",
    "189.22.234.39:80",
    "160.191.180.159:7777",
    "119.93.145.82:3128",
    "122.52.185.72:8080",
    "128.199.202.122:8080",
    "170.106.64.217:13001",
    "104.129.194.43:11036",
    "113.108.13.120:8083",
    "181.78.211.95:999",
    "43.135.177.23:13001",
    "43.153.14.194:13001",
    "8.212.168.170:9098",
    "43.135.172.170:13001",
    "42.114.226.95:10036",
    "107.181.161.81:4145",
    "103.175.240.54:9191",
    "103.249.86.48:3128",
    "170.106.137.158:13001",
    "43.153.105.141:13001",
    "103.167.170.69:5758",
    "85.15.21.102:8080",
    "114.224.143.220:8089",
    "67.43.228.254:15471",
    "77.91.70.115:36748",
    "103.175.240.87:8080",
    "43.153.112.164:13001",
    "36.95.78.156:3128",
    "43.153.16.150:7654",
    "103.147.134.59:8080",
    "103.18.112.5:1111",
    "116.254.99.157:8097",
    "123.200.14.194:8080",
    "38.45.242.120:999",
    "118.179.151.57:5020",
    "113.160.133.32:8080",
    "79.106.170.126:4145",
    "43.153.78.185:13001",
    "8.212.168.170:3128",
    "117.74.65.207:443",
    "200.250.131.218:80",
    "61.160.236.62:8888",
    "43.130.39.127:13001",
    "49.51.193.30:13001",
    "103.247.13.131:8080",
    "49.51.242.102:13001",
    "103.154.92.74:8080",
    "49.51.249.217:13001",
    "36.88.111.250:8787",
    "143.42.66.91:80",
    "170.106.74.95:13001",
    "61.186.243.6:9002",
    "43.153.102.53:13001",
    "45.224.117.74:999",
    "72.10.160.170:20091",
    "38.152.65.77:2335",
    "190.97.228.46:465",
    "46.187.46.173:8080",
    "170.106.107.197:13001",
    "5.75.197.16:10602",
    "47.245.126.204:22",
    "45.128.135.1:1080",
    "185.189.100.94:8080",
    "43.130.16.92:13001",
    "141.95.238.126:8080",
    "43.135.130.198:13001",
    "168.121.242.66:999",
    "103.213.218.81:14152",
    "195.187.22.223:8080",
    "108.175.23.225:13135",
    "125.128.25.151:11011",
    "188.132.150.77:8080",
    "50.235.247.114:8085",
    "103.247.14.137:8285",
    "170.106.184.19:13001",
    "154.236.168.176:1976",
    "106.38.26.22:2080",
    "85.10.199.48:80",
    "162.245.239.110:63506",
    "42.114.226.95:10004",
    "49.51.182.56:13001",
    "4.216.195.194:3128",
    "43.135.132.181:13001",
    "8.213.195.191:80",
    "125.87.89.58:2324",
    "49.51.197.116:13001",
    "27.147.195.170:58080",
    "43.153.48.105:13001",
    "103.41.33.169:58080",
    "27.50.29.166:8085",
    "72.10.160.170:27273",
    "162.240.58.147:53343",
    "80.249.112.162:80",
    "103.229.83.106:6789",
    "187.251.130.156:8080",
    "195.87.136.2:5331",
    "43.135.178.216:13001",
    "170.106.140.86:13001",
    "67.43.227.226:12719",
    "103.167.68.90:8181",
    "68.183.184.35:3128",
    "0.113.168.69:1080",
    "71.14.218.2:8080",
    "116.99.59.102:8080",
    "49.51.232.89:13001",
    "190.128.248.134:999",
    "103.106.112.166:1234",
    "92.93.165.66:3128",
    "43.153.16.223:13001",
    "43.159.28.112:19538",
    "43.130.2.135:13001",
    "43.153.106.210:13001",
    "47.74.46.81:3128",
    "43.130.42.164:13001",
    "91.211.212.6:32650",
    "43.153.85.114:13001",
    "208.67.28.28:58090",
    "98.83.213.181:8888",
    "85.192.30.198:3128",
    "38.65.172.3:999",
    "65.108.203.36:28080",
    "162.223.90.130:80",
    "49.48.64.212:8080",
    "103.172.35.64:8080",
    "202.176.1.77:5555",
    "188.117.108.71:3128",
    "189.22.234.32:80",
    "45.92.177.60:8080",
    "170.80.234.145:8080",
    "103.180.123.217:8080",
    "201.91.248.67:20183",
    "188.117.108.76:3128",
    "189.222.163.175:999",
    "170.106.153.126:13001",
    "43.202.54.198:7188",
    "171.237.121.209:1009",
    "43.135.164.4:13001",
    "72.10.160.170:22393",
    "106.12.111.83:9103",
    "72.37.216.68:4145",
    "38.156.72.40:8080",
    "43.153.94.60:13001",
    "38.172.130.221:999",
    "103.175.202.182:8090",
    "212.252.71.9:8080",
    "43.130.47.163:13001",
    "216.229.112.25:8080",
    "188.117.108.66:80",
    "43.153.32.146:13001",
    "46.203.125.214:12345",
    "159.65.230.46:8888",
    "49.51.184.182:13001",
    "43.153.118.253:13001",
    "1.4.250.70:8080",
    "204.199.140.14:999",
    "96.9.74.91:8080",
    "79.100.2.191:3128",
    "42.114.226.95:10030",
    "49.51.179.77:13001",
    "201.71.137.90:5128",
    "103.174.145.46:82",
    "170.106.173.197:13001",
    "72.10.160.170:28947",
    "47.243.113.74:5555",
    "102.213.223.46:83",
    "43.153.99.175:13001",
    "43.135.185.22:13001",
    "103.187.164.66:8080",
    "49.51.203.51:13001",
    "43.159.129.136:13001",
    "117.74.65.207:80",
    "67.43.236.19:4263",
    "201.204.47.66:5678",
    "49.51.70.77:13001",
    "47.88.18.204:8023",
    "156.67.214.169:3128",
    "60.188.102.225:18080",
    "170.106.110.139:13001",
    "121.234.73.213:9002",
    "67.43.228.250:17399",
    "45.12.254.22:3128",
    "43.135.138.21:13001",
    "43.135.134.89:13001",
    "219.135.102.83:8893",
    "88.247.165.215:41165",
    "227.54.113.126:8080",
    "43.135.136.84:13001",
    "18.163.90.139:8001",
    "202.182.55.44:8080",
    "58.209.32.83:8089",
    "179.61.154.8:8050",
    "170.106.107.101:13001",
    "160.19.18.75:8080",
    "43.135.166.98:13001",
    "188.125.169.100:8080",
    "181.78.84.79:999",
    "104.129.194.43:11035",
    "14.29.236.128:7897",
    "160.19.18.223:7777",
    "189.85.82.38:3128",
    "106.75.226.193:8119",
    "85.117.63.91:8080",
    "43.159.149.150:13001",
    "122.53.43.11:8080",
    "183.240.46.42:80",
    "43.130.2.30:13001",
    "43.153.46.52:13001",
    "38.65.172.193:999",
    "47.90.205.231:33333",
    "45.123.142.100:8181",
    "198.74.51.79:8888",
    "43.130.32.94:13001",
    "218.75.224.4:3309",
    "72.10.164.178:31873",
    "45.61.159.42:3128",
    "45.87.68.8:15321",
    "146.59.202.70:80",
    "43.135.130.88:13001",
    "188.117.108.66:443",
    "182.160.103.220:8090",
    "117.74.65.207:443",
    "45.191.7.249:8080",
    "170.106.170.175:13001",






	"http://170.106.73.178:13001",
	"http://170.106.168.138:13001",
	"http://170.106.100.130:13001",
	"http://43.135.177.23:13001",
	"http://43.135.139.239:13001",
	"http://170.106.67.179:13001",
	"http://170.106.99.182:13001",
	"http://43.135.129.111:13001",
	"http://182.72.203.255:80",
	"http://170.106.106.9:13001",
	"http://170.106.196.118:13001",
	"http://170.106.140.86:13001",
	"http://170.106.80.237:13001",
	"http://170.106.153.126:13001",
	"http://43.135.130.124:13001",



	"http://38.177.103.132:8899",
	"http://38.177.105.35:8899",
	"http://47.251.122.81:8888",
	"http://85.214.107.177:80",
	"http://158.255.77.169:80",
	"http://118.27.111.97:80",
	
	"http://50.207.199.80:80",
	"http://50.207.199.83:80",
	"http://50.174.7.153:80",
	"http://50.202.75.26:80",
	"http://50.239.72.18:80",
	"http://50.221.74.130:80",
	"http://50.175.212.74:80",
	"http://50.207.199.82:80",
	"http://50.174.7.152:80",
	"http://71.14.218.2:8080",
	
	
	"http://hrfcwnmp:h5842xrc9zzm@38.154.227.167:5868",
	"http://hrfcwnmp:h5842xrc9zzm@38.153.152.244:9594",
	"http://hrfcwnmp:h5842xrc9zzm@86.38.234.176:6630",
	"http://hrfcwnmp:h5842xrc9zzm@173.211.0.148:6641",
	"http://hrfcwnmp:h5842xrc9zzm@161.123.152.115:6360",
	
	"http://hrfcwnmp:h5842xrc9zzm@216.10.27.159:6837",
	"http://hrfcwnmp:h5842xrc9zzm@154.36.110.199:6853",
	"http://hrfcwnmp:h5842xrc9zzm@45.151.162.198:6600",
	"http://hrfcwnmp:h5842xrc9zzm@185.199.229.156:7492",
	"http://hrfcwnmp:h5842xrc9zzm@185.199.228.220:7300",


	/*'http://halusngj:iqii2z5mv1ke@38.154.227.167:5868',
	"http://tkifgotd:h5842xrc9zzm@38.154.227.167:5868",
	"http://tkifgotd:h5842xrc9zzm@38.153.152.244:9594",
	"http://tkifgotd:h5842xrc9zzm@86.38.234.176:6630",
	"http://tkifgotd:h5842xrc9zzm@173.211.0.148:6641",
	"http://tkifgotd:h5842xrc9zzm@161.123.152.115:6360",
	
	"http://tkifgotd:h5842xrc9zzm@216.10.27.159:6837",
	"http://tkifgotd:h5842xrc9zzm@154.36.110.199:6853",
	"http://tkifgotd:h5842xrc9zzm@45.151.162.198:6600",
	"http://tkifgotd:h5842xrc9zzm@185.199.229.156:7492",
	"http://tkifgotd:h5842xrc9zzm@185.199.228.220:7300",
	
	"http://83.168.72.172:8081",
	"http://185.132.242.212:8083",
	"http://80.249.112.163:80",
	"http://103.49.114.195:8080",
	"http://89.110.78.230:80",
	
	"http://79.110.200.27:8000",
	"http://79.110.201.235:8081",
	
	"http://83.168.74.163:8080",
	"http://93.171.157.249:8080",
	"http://203.74.125.18:8888",*/

	"http://43.153.25.185:13001",
	"http://43.153.61.52:13001",
	"http://43.153.91.13:13001",
	"http://43.153.85.114:13001",
	"http://43.153.2.82:13001",
	"http://43.153.7.172:13001",
	"http://31.40.248.2:8080",
	"http://139.59.1.14.2:80",
	"http://50.223.246.237:80",
	"http://50.174.7.159:80",
	"http://50.207.199.87:80",
	"http://32.223.6.94:80",
	"http://172.188.122.92:80",
	"http://13.38.153.36:80",
	"http://13.37.59.99:3128",
	
	"http://50.122.86.118:80",
	"http://188.68.52.244:80",
	"http://184.169.154.119:80",
	"http://13.56.192.187:80",
	
	
	"http://13.38.153.36:80",
	"http://13.36.104.85:80",
	"http://13.37.73.214:80",
	"http://44.195.247.145:80",
	"http://50.174.7.153:80",
	"http://165.232.129.150:80",
	"http://50.239.72.18:80",
	"http://50.217.226.47:80",
	"http://50.239.72.19:80",
	
	"http://50.221.74.130:80",
	"http://190.58.248.86:80",
	"http://203.115.101.51:82",
	"http://188.68.52.244:80",
	"http://184.169.154.119:80",
	"http://13.56.192.187:80",
	"http://4.145.89.88:8080",
	
	"http://85.215.64.49:80",
	"http://23.247.136.248:80",
	"http://13.208.56.180:80",
	"http://35.72.118.126:80",
	"http://3.71.239.218:3128",
	
	"http://35.76.62.196:80",
	"http://3.127.62.252:80",
	"http://18.228.149.161:80",
	
	"http://46.51.249.135:3128",
	"http://43.200.77.128:3128",
	"http://54.233.119.172:3128",
	
	"http://52.67.10.183:80",
	"http://200.250.131.218:80",
	"http://52.196.1.182:80",
	
	"http://204.236.176.61:3128",
	"http://3.130.65.162:3128",
	
	
	
	//'http://halusngj:iqii2z5mv1ke@38.154.227.167:5868',//'http://64.62.219.99:3128',
];


app.get('/image-json', async (req, res) => {
	res.write(JSON.stringify(jsonImages));
	res.end();
});


app.get('/json', async (req, res) => {
	res.write(JSON.stringify(jsonTickers));
	res.end();
});



//const proxy = 'http://64.62.219.99:3128';
app.get('/proxy', async (req, res) => {
	const targetUrl = req.query.url;


	// Set initial proxy
	let proxyIndex = 0;
	let proxy = proxyList[proxyIndex].includes('http') ? proxyList[proxyIndex] : "http://" + proxyList[proxyIndex];
	const proxyRetries = 5;
	let maxRetriesAttempt = proxyRetries;
	let agent = new HttpsProxyAgent(proxy);

	for (let loop = 0; loop < tickers.length; loop++) {
		let ticker = tickers[loop];
		
		let shouldLoop = true;
		let reply;
		
		res.write("TICKER: " + ticker + ' \n');
		res.write("Using proxy: " + proxy + ' \n');

		while (shouldLoop) {
			try {

				await delay(1000)
				await fetchWithTimeout(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${ticker}&outputsize=full&apikey=dem`, {
					agent: agent,
				}, 15000).then(d => d.json()).then(async resp => {
					reply = resp;
					if (resp['Information']) {
						res.write(JSON.stringify(resp));
						//shouldLoop = false;
						maxRetriesAttempt = 0;
						throw new Error("Error api exceed usage limits");
						//throw new Error("Error api exceed usage limits");
					}
					
					if(resp['Error Message'] && resp['Error Message'].includes('Invalid API call')){
						shouldLoop = false;
						throw new Error("Skipping " + ticker);
					}
					
					if (!resp['Time Series (Daily)']) {
						res.write(JSON.stringify(resp));
						throw new Error("Error data not found");
					}

					let arr = [];
					for (const [date, values] of Object.entries(resp['Time Series (Daily)'])) {
						arr.push({
							d: date,
							o: values['1. open'],
							h: values['2. high'],
							l: values['3. low'],
							c: values['4. close'],
							v: values['5. volume']
						});
					}
					
					if(!arr.length)
						throw new Error("Error length is zero");



					let string = "";
					arr.forEach((values, index) => {
						string += values.d + "," + values.o + "," + values.h + "," + values.l + "," + values.c + "," + values.v;
						if (index !== arr.length - 1) {
							string += ";";
						}
					});

					let widthIndex = 0;
					let heightIndex = 0;

					let width = 800;
					let height = Math.ceil(string.length / 6 / width);

					// Fill up empty spaces
					let paddingCount = 6 - (string.length % 6);
					while (paddingCount--) {
						string += " ";
					}

					// Create a canvas element
					let canvas = createCanvas(width, height);

					// Get the 2D drawing context
					let ctx = canvas.getContext('2d');

					// Define a color (RGB) - white
					ctx.fillStyle = 'rgb(255, 255, 255)';

					// Fill the entire canvas with the color
					ctx.fillRect(0, 0, canvas.width, canvas.height);

					for (let i = 0; i < string.length; i += 6) {
						// Get RGB values from the encoded pixel data
						let red = ((getEncodedPixelData(string[i]) & 0xF) << 4) | (getEncodedPixelData(string[i + 1]) & 0xF);
						let green = ((getEncodedPixelData(string[i + 2]) & 0xF) << 4) | (getEncodedPixelData(string[i + 3]) & 0xF);
						let blue = ((getEncodedPixelData(string[i + 4]) & 0xF) << 4) | (getEncodedPixelData(string[i + 5]) & 0xF);

						// Set the pixel color
						ctx.fillStyle = `rgb(${red}, ${green}, ${blue})`;
						// console.log(`rgb(${red}, ${green}, ${blue})`)
						// Draw the pixel at the current position
						ctx.fillRect(widthIndex, heightIndex, 1, 1);

						// Move to the next pixel
						widthIndex++;
						if (widthIndex === width) {
							widthIndex = 0;
							heightIndex++;
						}
					}

					// Create a link to download the canvas as a PNG
					let base64Image = canvas.toDataURL('image/png');
					//res.write(base64Image);
					//return;

					
					const albumId = "w2q9yRA";//,"YcnD8zI";//'G0DQ6Hk'; // Imgur album ID
					const accessToken = 'ffc8fd46eb1f0d2bf28d099af47f421eb574bfa3'; // Imgur access token
					
					
					//res.write( JSON.stringify(dd) + `\n`);
					//res.write( base64Image + `\n`);
					
					//return;
					
					if(1){
						shouldLoop = false;
						jsonImages[ticker] = {
									"image-name": ticker + ".png",
									"ticker": ticker,
									"type": "daily",
									"from": arr[arr.length - 1]['d'],
									"to": arr[0]['d'],
						}
						createImageFile(ticker + ".png", base64Image);
					}
					
					// Temporarily bypass Imgur
					if(false){
						let dd = {
							"imgur-id": imageId,
							"ticker": ticker,
							"type": "daily",
							"from": arr[arr.length - 1]['d'],
							"to": arr[0]['d'],
						}
					
						let r = await uploadImageToImgur(base64Image, accessToken, JSON.stringify(dd));
						if (r['success']) {
							let imageId = r['data']['id'];
							res.write(`Image uploaded successfully. ID: ${imageId} \n`)
							jsonTickers[ticker] = {
									"imgur-id": imageId,
									"ticker": ticker,
									"type": "daily",
									"from": arr[arr.length - 1]['d'],
									"to": arr[0]['d'],
							};
							let albumR = await addImageToImgurAlbum(imageId, albumId, accessToken);

							if (albumR['success']) {
								res.write(`Image Album Added successfully \n`)
							} else {
								res.write(`Added album failed \n`)
							}
							shouldLoop = false;
						} else {
							res.write(`Image uploaded failed \n`)
							res.write(JSON.stringify(
								{
									base64Image:base64Image,
									description:dd,
								}
							));
							res.write(`\n`)
							shouldLoop = false;
						}
					}
				})


			} catch (error) {
				res.write(maxRetriesAttempt + ' Attempt : Error: ' + error.message + ' \n');
				res.write(JSON.stringify(reply) + ' \n');
				maxRetriesAttempt--;
			}
			
			if (maxRetriesAttempt <= 0) {
				if (proxyIndex === proxyList.length - 1){
					shouldLoop = false;
					res.write('All proxies failed \n');
					res.write(JSON.stringify(jsonTickers));
					res.end();
					return;
				}

				// Set next proxy
				maxRetriesAttempt = proxyRetries;
				proxyIndex++;
				proxy = proxyList[proxyIndex].includes('http') ? proxyList[proxyIndex] : "http://" + proxyList[proxyIndex];
				agent = new HttpsProxyAgent(proxy);
				res.write('Switched to proxy: ' + proxy + ' \n');
			}
		}

	}
	
	res.write(JSON.stringify(jsonTickers));
	res.end();
});
app.listen(3000, () => console.log('Server running on port 3000'));
