<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Pixi Lights Example</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/pixi.js@7/dist/pixi.min.js"></script>
  <script src="https://unpkg.com/@pixi/layers/dist/pixi-layers.js"></script>
  <script src="https://userland.pixijs.io/lights/dist/pixi-lights.js"></script>

  <script>
  
    // Create Pixi application
    const app = new PIXI.Application({
      width: window.innerWidth,
      height: window.innerHeight,
      backgroundColor: 0x0
    });
    document.body.appendChild(app.view);

    // Use Stage from pixi-layers (deferred rendering)
     const stage = app.stage = new PIXI.layers.Stage();

    // Groups for lighting
    const { diffuseGroup, normalGroup, lightGroup, PointLight } = PIXI.lights;

    // Load textures
    const diffuseTex = PIXI.Texture.from('https://marcustansoon.github.io/PhysicsEngine.js-2D/temp/test/battle-ui.jpg');
    const normalTex  = PIXI.Texture.from('https://marcustansoon.github.io/PhysicsEngine.js-2D/temp/test/battle-ui-normal-v1.png');

    // Create diffuse sprite
    const diffuseSprite = new PIXI.Sprite(diffuseTex);
    diffuseSprite.width = app.screen.width;
    diffuseSprite.height = app.screen.height;
    diffuseSprite.parentGroup = diffuseGroup;

    // Create normal sprite
    const normalSprite = new PIXI.Sprite(normalTex);
    normalSprite.width = app.screen.width;
    normalSprite.height = app.screen.height;
    normalSprite.parentGroup = normalGroup;

    // Create a point light
    const light = new PIXI.lights.PointLight(0xffffff, 1.0);
    light.x = app.screen.width / 2;
    light.y = app.screen.height / 2;
    
    
    
// Create directional light
const dirLight = new PIXI.lights.DirectionalLight(0xffffff, 0.7);
dirLight.rotation = Math.PI / 4; // 45Â° angle
dirLight.parentGroup = lightGroup;

    // Container for everything
    const container = new PIXI.Container();
    container.addChild(normalSprite, diffuseSprite, light, );

    // Add layers and container to stage
    app.stage.addChild(
      new PIXI.layers.Layer(diffuseGroup),
      new PIXI.layers.Layer(normalGroup),
      new PIXI.layers.Layer(lightGroup),
      container, 
    );






    // Resize handling
    window.addEventListener('resize', () => {
      app.renderer.resize(window.innerWidth, window.innerHeight);
      diffuseSprite.width = app.screen.width;
      diffuseSprite.height = app.screen.height;
      normalSprite.width = app.screen.width;
      normalSprite.height = app.screen.height;
    });
    
    
    
    // Enable pointer tracking on stage
    stage.eventMode = 'dynamic';
    stage.hitArea = app.screen;

    let targetX = light.x;
    let targetY = light.y;

    // Mouse move listener (Pixi v7 syntax)
    stage.on('pointermove', (event) => {
      const pos = event.global;
      targetX = pos.x;
      targetY = pos.y;
    });

    // Animate light to follow cursor smoothly
    app.ticker.add(() => {
      light.x += (targetX - light.x) * 0.15;
      light.y += (targetY - light.y) * 0.15;
    });
    
  </script>
</body>
</html>
